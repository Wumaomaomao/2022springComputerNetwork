# 《计算机网络》复习提纲

## Chapter 1.Introduction of Networking

### Basic Concepts and Questions

#### 什么是网络？

+ 为了使得信息在顶点之间传输的一个在顶点之间相互连接的链路系统。

#### ==什么是因特网？==

+ 因特网是一个为了连接全球数十亿计算设备的**使用TCP/IP协议**创建的互联了全球**主机**、**个人**和**无线计算机网络**的**全球系统**。

  （直接定义）

+ 它是一个由数百万的从**局域到全球**的个人，公用、学术、商业以及政府**网络构成的网络**，并且通过有线电路，无线技术和其他网络技术将这些网络连接在一起。

  （递归定义）
  
+ 通信的基础设施

####  ==因特网的组成==
##### 组成部件

+ **端系统（主机）**

  运行网络应用程序

+ **通信链路**

  同轴电缆，铜线，光纤，无线电频谱

  建立物理连接

+ **分组交换机**

  链路层交换机和路由器

  向目的地转发分组

##### 服务视角

+ **向应用层提供服务的通信基础设施**

  分布式应用程序

  Web，VoIP等

+ **向App提供服务**

  可靠数据传输

  尽力而为服务

  时延和吞吐量保障

##### 协议视角

+ 协议定义了在两个或多个**通信实体**之间交换的报文的**格式**和**顺序**，以及**报文发送和/或接收一条报文**或其他事件所采用的**动作**。

#### ==如何接入网络？==

##### 网络边缘

+ 组成：**应用程序**和**端系统**

+ 端系统：端系统 （主机）分为：**客户**和**服务器**。

+ 形成两种通信模型：

  **Client/server model**

  用户主机请求，接收服务器的服务
  
  eg.Web 浏览器/服务器，Email浏览器/服务器
  
  **Peer-to-peer model**
  
  eg.Skype,BitTorrent

##### 接入网络

+ 组成：物理媒体、有线和无线的通信链路。

  + 物理媒体

    双绞铜线，同轴电缆，多模光纤缆，无线电频谱。

    + 导引型媒体和非导引型媒体

      固体传播和空气中传播

    + 光纤的优势

      高速传播

      不受电磁干扰

      衰减极低
  
    + 无线电
  
      + 通过电磁频谱传播，双工
  
      + 可能受到环境影响：反射，物体阻碍，干扰
  
      + 主要应用场景：微波通讯，无线局域网，广域无线网以及卫星通讯
  
  + 家庭接入
  
    **调制解调器**：将数字信号转换为模拟信号
  
    DSL：数字用户线，电话公司提供网络接入。
  
    HFC：混合光缆同轴，有线电视公司电缆接入。
  
  + 企业接入
  
    **局域网（LAN）**接入**边缘路由器**
  
  + 广域无线接入
  
    用户仅需要位于基站的几万米范围内
  

##### 网络核心

+ 由**分组交换机**和**链路**构成的网状网络

+ 如何通过网络传输数据？

  + 交换机网络：端系统和网络之间通过交换机连接，易于扩展，共享一条链路上的网络资源

  + **电路交换（circuit switching）**

    为每个会话预留资源

    通过路径上的交换机维护端系统之间的连接

  + **分组交换（packet-switching）**

    端系统将应用层报文划分为分组

    通过通信链路和分组交换机传送分组从源到目的地

    

#### ==电路交换网络==

+ 为每个链接预留资源，以链接单位做准入控制

+ 过程：

  1、源向目的地发送预留请求

  2、交换机在允许控制后建立电路

  3、源发送数据到目的地

  4、源发送断开电路请求

+ **优势和劣势**

  + **优势**

    + 可**预测**的服务效果
  + 简单快速的信息交换
    + 更适于实时服务

  + **劣势**

    + 复杂的电路**建立**和断开操作
    + 电路建立**时延**
    + 专用电路**空闲**时资源浪费
    + 交换机损坏导致电路损坏

#### ==分组交换网络==

+ 各个分组独立按需处理，以分组单位做准入控制

+ **存储转发机制**

  交换机在能够向输出链路传输分组的第一个比特之前，必须接收到整个分组。

+ **排队时延和丢包**

  由于资源需求总数超过了可用量产生的资源**竞争**

  在**输出缓存**中等待

  如果没有存储空间就会发生**丢包**。

+ **优势和劣势**

  + **优势**

    + 对网络资源的更高效使用
    + 更简单
    + 鲁棒性更强
  + **劣势**
    + 不可预测的服务效果
    + 需要缓存管理和拥塞控制
  + **统计多路复用**（按需共享带宽）
    + 允许网络同时处理更多需求，但不能满足所有需求
    + 传输结果不可预测
    + 在极端情况外工作效果良好

#### ==虚电路==

+ 用分组来模拟电路交换

  + 路由器和经过的链路是**固定的**

  + 共享网络资源->需要**拥塞控制**
  + 需要**建立呼叫链接**

+ 以上三者的比较

  |          | 电路交换                 | 数据报分组交换           | 虚电路分组交换                                 |
  | -------- | ------------------------ | ------------------------ | ---------------------------------------------- |
  | 传输通路 | 专用                     | 非专用                   | 非专用                                         |
  | 连续性   | 连续传输                 | 分组传输                 | 分组传输                                       |
  | 带宽     | 固定                     | 动态                     | **固定**                                       |
  | 路由     | 固定                     | 动态                     | **固定**                                       |
  | 时延     | 实时（只有呼叫建立时延） | 分组传输时延             | 分组传输时延+呼叫建立时延                      |
  | 扩展性   | 差（接入用户有上限）     | 好（用户数量可动态扩充） | 较好（用户数量动态，由拥塞控制来保证服务质量） |

### Protocol Layers and Service Model

#### ==多层协议体系的必要性==

+ 分层的含义：**依赖**于底层提供的服务通过在该层**执行**某些动作提供**服务**。

+ 分层的意义

  + 结构化

    清晰的**体系结构**允许了在复杂系统中对其**组成部分**中识别和建立联系。

  + 模块化
  
    **模块化**的使得复杂系统的**维护**和**更新**更加容易。
    
    改变服务的实现不会影响系统中的其他组件
  
+ 分层的缺陷

  + 更高的开销
  + 冗余底层的功能
  + 需要跨层的信息，违反层次分离的目标

#### 标准网络协议体系

##### OSI协议模型(Open system Interconnection)

+ 特点

  + 每层执行所需通信服务的一个**子集**

  + 每层依赖于**更低一层**提供的服务来执行某些动作
  + 每层向**更高一层**提供服务
  + 对某一层进行**更改**不会需要对其他层次更改

+ 组成：七层结构

  + **物理层**

    + **功能**

      跨越**链路**传输帧中的一个个**比特**
    
      指定链路的物理媒介
    
    + 信息分组：比特
    
  + **链路层**
  
    + **功能**
    
      + 比特聚合成**帧**
      + 建立、维护和断开数据**链路链接**
      + 通过直接链接**传输**帧
      + 在局域网中实现媒介控制访问(**MAC**)
      + 检测**比特错误**
      + 帧**重传**
      + 端到端的**流控制**
      + **无差错**传输
      
    + 信息分组：帧
    
    + 和网络层的关系
    
      在每一个节点（路由器或主机）网络层将数据报下放给链路层，链路层沿着链路将数据报传输给另一个节点，在另一个节点链路层将数据报上交给网络层
    
  + **网络层**
  
    + **功能**
    
      + 在多种链路\网络中在主机间**传输数据报**
    
      + 在更大的网络中**寻址**
    
      + 节点共同运行**路由**算法来决定路径
    
      + 经过节点**转发**数据报
    
      + **拥塞**控制
    
      + 在基于**链接**时建立、维护和断开链接
    
    + 信息分组：数据报
    
    + 与传输层的联系
    
      源主机的传输层协议向网络层**递交**传输层**报文段和目的地址**，网络层将分组从一台主机移动到另一台主机
    
  + **传输层**
  
    + **功能**
  
      + 在端系统的**进程**之间交换数据
  
      + 提供**可靠**的**流**传输或者简单快捷的**单块**传输
  
        无差错报文、按序交付报文、无丢失报文、无重复报文
  
      + 建立、维持和断开连接
  
    + 信息分组：报文段
  
    + 与应用层的联系
  
      向应用程序提供了面向连接的可靠服务（TCP）或者不提供不必要服务的无连接服务（UDP）
  
  + **会话层**（Session）
  
  + **表示层**（Presentation）
  
  + **应用层**
  
    + **功能**
  
      在不同端系统上的应用程序之间交换报文
  
    + **信息分组**：报文

##### TCP/IP协议体系

+ **应用层**、**表示层**和**会话层**合并为TCP/IP协议栈应用层

+ **网络层**

  支持网络应用程序

  + FTP、SMTP、HTTP、DNS、NTP

+ **传输层**

  进程之间的数据通信

  + TCP、UDP

+ **网络层**

  在网络的网络中实现数据报的路由

  + IP, routing protocol（**只有一种网络层协议，可以说IP是网络层次体系的沙漏腰部**）

+ **链路层**

  在相邻的路由器或逐渐间传输信息

  + PPP, Ethernet,FDDI

+ **物理层**

  在电路上移动比特

  + Opitical Copper Radio PSTN
  
+ **有效载荷**

  有用信息 \ (包头 + 有用信息)

+ **Protocol data unit（PDU）**

  控制信息 + 用户数据

#### 网络性能分析

##### ==网络时延==

+ 网络时延的组成

  取决于网络连接的性能

  + 传输时延

    将分组的所有比特推向电路的时间
    $$
    Packet \ size \ / \ Transmission \ rate \ of \ the \ link \ (带宽)
    $$
    ps.1 Mps = 1 * 10^6^bps

  + 传播时延

    从链路的起点到终点经过物理媒体传播的时间
    $$
    length \ / \ Propagation \ speed \ of \ the\ link
    $$
    

  取决于网络的拥塞程度和交换机的内部时延

  + 排队时延

    在缓存中等待传输的时延

    + 影响因素

      队列的到达速率

      到达流量的性质

      传输带宽

    + **Little Law**

      $L = A \times W$

      平均队列等待长度 = 平均到达速率 * 平均等待时间

  + 处理时延

##### ==丢包==

+ 到达的分组发现一个满的队列，丢弃该分组
+ 丢包率根据流量强度增加而增加

##### ==吞吐量==

+ 在目的地接收源的数据的速率
  $$
  Average throughput \ = F \ / \ T \approx R \ (文件大小 / 总传输时间)
  $$

+ 在多段链路上传输时，吞吐量取决于传输速率最小的链路，也就是瓶颈链路

## Chapter 2：Link Layer

### Link Layer Service



+ 结点

  主机和分组交换机

+ 链路

  + 含义

    连接**相邻**结点的**通信信道**

  + 种类

    + 有线点到点链路
    
      专用成对通信信道
    
    + 有线多路访问链路
    
    + 无线链路

+ 信息分组

  + 帧（封装数据报）

    在相邻节点或者同一个**局域网中的节点**之间传输数据

+ 实现位置

  + 端系统主机或者路由器（交换机）

  + 网络适配器（adaptor）

    实现了**物理层和链路层**协议，与主机系统**总线**连接

    是硬件实现，软件实现和固件实现的结合

    例如：NIC，以太网卡，802.11卡
  
#### ==链路层服务==

+ **成帧**

  + 发送方

    **封装**数据报

    添加**头部字段**和**尾部字段**，差错检测和流控制字段

  + 接收方

    提取数据报上传网络层

    差错检测，流控制

+ **链路接入（多路访问控制）**

  + 点到点链路

  + 广播链路

    共享物理媒体

    i.e.以太网，802.11无线网络

    + ==**多路访问控制**==

    需要**分布式算法**决定结点如何共享信道，在**共享的广播信道**中避免多个结点同时传输

    + 理想的算法

      1、如果有**一个结点**在传输，速率为R

      2、如果**M个结点**想要传输，速率平均为R/M

      3、**分散**的，去中心化的，不需要主结点和同步机制

      4、易于实现的，**简单**的

    + **MAC协议**

      + **信道划分**（三种方式）

        有点：公平

        + 时分多路复用(TDM(A))

          将时间划分为时间帧，将每个时间帧划分为N个时隙

          速率：R / N

          缺陷：速率被限制，需要等待轮次

        + 频分多路复用(FDM)

          将信道频谱划分为不同的频段

          速率：R / N

          缺陷：带宽被限制

        + 码分多址复用(Code Division Mutiple Access：CDMA)

          为每一个结点分配一个唯一的编码，编码是**正交**的，不同结点可以**同时传输**而不在意其他结点的干扰
          
          + 应用
          
            无线广播信道：蜂窝网络和卫星广播

      + **轮流协议**（两种）

        + 轮询协议

          **主节点**循环轮询每个结点

          + 缺点

            轮询时延

            主节点崩溃
            
          + i.e.蓝牙

        + 令牌环协议

          如果一个结点要发送帧时才持有令牌，否则转发给下一个结点

          + 优点

            效率高

            **分散协议**

          + 缺点

            一个结点故障可能导致系统崩溃

            可能忘记释放令牌

      + **随机接入**

        + 内容

          + 如何发现和避免碰撞
          + 如何从碰撞中恢复过来

        + 具体实现

          + **ALOHA**

            + 发送方：立刻传输帧

              如果未收到ACK，**以p的概率立刻重传，以(1-p)的概率进入等待**

            + 接收方：帧无误后ACK

          + **Slotted ALOHA**

            + 定义**长度相同的帧**，**时隙的长度**刚好为**帧的传输时间**
            + 结点之间互相**同步**
            + 在时隙**边界开始**传输
            + 帧要么**完全碰撞**要么不发生碰撞
            
            + 帧在形成的下一个时隙传输
            + 如果发生碰撞，以p的概率重传直到成功发送
            
          + **CSMA**（Carrier Sense Mutiple Access：载波侦听多路访问）
          
            + 在传输之前侦听信道，如果空闲发送帧，否则推迟发送
          
            + 但是可能由于**结点之间的距离导致的传播时延发生碰撞！**所以不能完全消除碰撞
          
          + **Nonpersistent CSMA**（非连续CSMA）
          
            + 侦听时如果信道繁忙，**等待一段随机的时间再次侦听**
          
              可能会浪费信道资源
          
            + 如果发生碰撞，等待随机一段时间
          
          + **1-persistent CSMA**
          
            + 侦听直到信道空闲开始传输
          
              如果由两个及以上的结点在侦听，就会发生碰撞
          
            + 如果发生碰撞，等待随机一段时间
          
          + **p-persistent CSMA**
          
            + 侦听到信道空闲，以p的概率传输，以1-p的概率推迟一个时间单元
          
              通常时间单元的大小为最大的传播时延
          
            + 如果发生碰撞，等待随机一段时间
          
            + p的取值
          
              避免在网络符合较重时的不稳定
          
              在N个站点等待发送时，最佳取值为1/N
          
          + **CSMA/CD**（Collison Detection）
          
            1、信道空闲，直接传输
          
            2、信道忙碌，等待空闲传输
          
            3、侦察到碰撞，发送jam signal放弃传输
          
            4、jam之后，等待随机一段时间会回到第一步
          
            + 碰撞侦察
          
              碰撞会产生较高的信号电压
          
              信号可能会衰减，所以需要jam信号
          
              **当一个站点正在传输时接收到了别的站点的数据则说明发生了碰撞**
              
            + **最小帧长**
            
              需要保证在检测到冲突之前没有完全发送整个帧
            
              （比较极端的情况是当到达对方站点的时候对方开始传输）
              $$
              Size / bandwidth \ \ge 2 \times L / v（两倍的传播时延）
              $$
              
            
          + **指数级退避算法**
          
            1、在起先的10次尝试中，随机等待的时间成倍增加在0~2^k^-1之间选择（第k次碰撞）
          
            2、在之后的6次尝试中，等待时间不变
          
            3、16次失败的尝试后，放弃传输，报错
          
            + 对于发生更少碰撞的站点可以优先传输 
          

  + MAC地址

  + 半双工和全双工服务

+ **链路层可靠传输**

  + 在低比特错误率的链路中很少使用（比如光纤链路），而无线链路常常错误率较高

  + **流控制**：在相邻的发送和接收节点间控制发送速率，确保**不要超过接收方**的承受能力

    + **Stop and Wait**

      只允许一个帧在链路上发送

      接收方通过控制发送ACK的速率来实现流控制

    + **Sliding Window**：需要**序号和窗口**

      允许多个帧在链路上发送

      维护Window缓存分组

      ACK表明接收方想要的**下一个帧**的序号

    + Sliding Window的差错处理

      + **Go back N**

        接收方发送NAK

        从错误帧开始的帧全部重传

      + **Selective Reject**

        仅重传失败的帧

+ **差错检测与纠正**

  + 处理由于**信号减弱**和**噪声**产生的差错

  + 接收方**检测差错**出现，发送方**重传**帧

  + **EDC**（差错检测和纠正比特）

  + 具体方法

    + 奇偶校验

      + 一维

      + 二维

        可以检测和纠正一个比特的差错

        + 前向纠错

          减少重发的次数和往返的时延

        可以检测但**不能纠正**发生在一个组内的两个比特差错

    + ==循环冗余检测==

      + CRC计算中加减法用**异或**做，不存在进位以及借位

      + 符号

        数据：D

        生成多项式：G（r+1位）

        附加比特：R（r位）

        计算：（通过列竖式用异或做加减运算求余数）
        $$
        R =remainder( {D \cdot 2^r \over G})
        $$

### local Area Network（LAN）

#### 令牌环

+ station通过reapeater和另外两条链路连接

+ 帧在环中传输一圈后被丢弃

+ repeater三个状态

  + 监听态

    + 扫描经过的数据
    + 对于收到的帧修改为ACK

  + 传输态

    + 回收帧或者ACK帧
    + 重传帧

  + 经过态

    经做连接功能

#### 以太网

+ 地位

  + 主导的局域网技术

  + 便宜，简单，广泛使用

+ 拓扑结构

  + 总线结构（早期）

    所有结点可能碰撞

  + 星形结构（现代）

    交换机位于中心

    结点之间不发生碰撞

+ 广播链路技术（早期）

  + 使用CSMA/CD多路访问控制

    + 采用**1-persistant**的CSMA/CD算法，在第一次碰撞后，**在{0,1,2,...,2m- 1}中随机选择一个数字K**,等待512*k**bit times**后重新侦听

    + 第一次碰撞之后，采用指数级退避算法

+ 交换网络技术（现代）

  交换机和主机之间采用点对点链路

  使用“自学习”和生成树算法

+ 特点

  + **无连接**服务

    网络适配器之间无握手过程

  + **不可靠**服务

    无确认机制（依赖上层协议重传）

+ 以太网帧格式

  单位：bytes

  | Dst Address(6) | Src Address(6) | Type(2) | Data payload(max 1500/min 46) | CRC(4) |
  | -------------- | -------------- | ------- | ----------------------------- | ------ |

  + 头部字段长度：14bytes
  + 尾部字段长度：4bytes
  + 数据载荷：46~1500bytes
  + 最大帧长度为：1518bytes
  + 最小帧长度为：64bytes

+ MAC地址

  + 含义

    + 网络适配器地址
    + 48bits数字地址（分为6段八位地址）
    + 硬编码在网络适配器上

  + 地址划分含义

    + 块地址

      前24bits地址由IEEE分配给生产商

    + 适配器地址

      后24bits由生产商从块地址中分配下来

+ 成帧

  网络适配器完成

  + 链路层如何判断帧的开始和结束位置？

    发送时在头部包括帧长度

  + 如果被干扰后如何重新同步？

    在帧的首部和尾部加入哨兵字段，并且确保帧内部不出现同样的连续比特串

+ IEEE

  802.3以太网媒介访问控制：**CSMA-CD**

  802.5 令牌环

  805.11 无线局域网

+ 物理媒介

  光缆，电缆等

### Performance of MAC

+ 媒体利用率
  $$
  U = {帧传输时间 \over 在共享媒体上占用的总时间}
  $$

+ 相对传播时间
  $$
  a = {传播时间 \over 传输时间} = {数据路径的长度(bits) \over 标准帧的长度(bits)}
  $$

+ 定义

  1：帧传输时间

  a：端到端的传播时间

  N：站点的个数

  Large frame：a < 1

  small frame: a < 1

+ 点到点链路

  最大媒体利用率为
  $$
  U = {1 \over 1 + a}
  $$

+ 令牌环

  + a < 1（传播时间小于传输时间）

    在t~0~+1时释放令牌，那么令牌会在t~0~+1+a到达下一个站点，在t~0~+1+a结束所有的传输过程

  + a > 1（传输时间小于传播时间）

    在t~0~+a时释放令牌，在t~0~+a+N/a到达下一个站点，在t~0~+a+1结束所有的传输过程

  + 最大利用率

    也就是从**拿到令牌到令牌到下一个站点**的时间为占用媒体时间
    $$
    U = {1 \over 释放令牌时间+ a / N}
    $$

+ Slotted ALOHA

  + 任意结点成功传输的概率为

  $$
  A = Np(1-N)^{N-1}
  $$

  求导得到最大值
  $$
  A = (1 - {1 \over N})^{N-1}
  $$

  + 成功传输最大利用率

    需要两个传播时间来观察碰撞
    $$
    U = {{1 \over {1 + 2a}} \approx 1}(a << 1)
    $$

  + 最大利用率
    $$
    U = U_{suc} \times A \approx (1 - {1 \over N})^{N-1} 
    \lim _{N \to \infty} U =e^{-1}
    $$

+ ALOHA
  $$
  U \approx A = Np(1-p)^{2N - 1} \approx {1 \over 2}(1 - {1 \over 2N})^{2N-1}(p = {1 \over 2N}) \approx 1/2e (N \to \infty)
  $$

+ CSMA/CD

  + 竞争区间
    + 是一序列的竞争时间
    + 竞争区间往往为2a

  （最糟糕的情况下需要2a的时间发现冲突）

  + p-连续最大利用率

    + 成功在一个时隙内传输的概率为
      $$
      A = C_N^1p(1-p)^{N-1}
      $$

    + A在p = 1/N时得到最大值
      $$
      A = (1 - {1 \over N})^{N-1}
      $$

    + 出现大小为j的竞争区间的可能性为
      $$
      A \times (1 - A)^j
      $$

    + 在一个竞争区间中出现的时隙个数的期望值为
      $$
      \sum _{i = 1}^\infty jA(1-A)^j = {1 -A \over A}
      $$
  
    + 最大利用率
  
      传输时间 + 传播时间 + 竞争区间产生的时间
      $$
      U = {1 \over 1 + a + 2a{1-A \over A}}
      $$
      

+ 当一个主机接入网络

  + 主机接入网络之前只知道MAC地址

+ DHCP

    + 分配自己的IP地址
    + 分配自己的网关
    + 本地DNS服务器的IP地址
    + 第一跳路由器的IP地址

  + DHCP过程

    + DHCP-**Discoer**

      主机在子网内**广播**

    + DHCP-**Offer**

      DHCP服务器回复

      在这一步服务器第一次分配了yidaddr

    + DHCP-**request**

      主机选择一个服务器**广播**（包括选中的服务器IP地址）

    + DHCP-**Ack**
    
      + 选中的服务器承认绑定
      + 接收的客户端根据**分配配置参数**设置自身参数

    + DHCP-**release**
    
      客户端结束绑定
    
      （绑定也会在客户端没有更新时自行灭亡）
    
  + DHCP过程的鲁棒性
  
    在O(lease period)后没有再次收到Refreshes（server）或ACK(client)，会自行回收或释放配置的地址
  
+ ARP

    + 在局域网内根据IP地址找到一个主机/路由器的MAC地址
    + 只工作在局域网
    + 和DNS比较，DNS时实现域名和IP地址的映射，基于数据库在广域内实现的

    + ARP过程
      + 每个主机维护一张ARP表
      + 发送端
        + 查询本地缓存
        + 构造ARP请求
        + 在局域网内广播
        + 缓存目的MAC映射关系和时间戳
      + 接收端
        + 检查IP地址
        + 构造ARP回复
        + 向发送端发送帧
        + 缓存发送方的映射关系和时间戳

+ 如何访问到远程主机
  + 通过DHCP获得子网掩码和第一跳路由器
  + 通过子网掩码判断不在子网内部
  + 使用ARP获知第一跳路由器的MAC地址
  + 发向第一跳路由器

+ DHCP的主要思想

  + 局域网内通过广播建立通信
  + 缓存信息进行学习
  + 软状态，设置超时机制

### Bridge and Layer-2 switch

#### 网桥

+ 含义

  连接局域网

  支持二层协议

  存储转发帧

  帧做比特级拷贝

  路由功能

+ 网桥的要求

  + 在不同的局域网之间存储转发
  + 结点意识不到网桥的存在，透明
  + 即插即用，自学习

+ 广播技术

  + 接收方链路层会将广播信息上交到网络层
  + 通过在网络上建立生成树规避网络风暴

+ 生成树算法（交换机路由算法）

  + 作用

    + 避免在网络中成环，产生网络风暴

    + 找到其他点到root的最短路径

      （通过选择ID比较小的点解决并列的情况）

    + $$
      Message(Y,d,X)
      $$

      X：X发出

      Y：建议Y作为root

      d：X到Y的距离为d

      交换机会**选择拥有最小的MAC值的节点作为root**

    + 执行过程

      + 开始时，每个结点总是**建议自己作为root（X,0,X）**
      + 结点在发现**Y < current root时更新root**
      + 通过**邻居到root的距离加一**来更新自己的最短距离
      + 如果root或者最短距离改变，重新发送信息告诉周边结点

    + 错误处理

      根结点需要定期发送统通知信息

      如果根结点不再发送信息通过超时报错

+ 交换机“自学习”路由

  + 接收到帧以后，将来的端口和局域网源地址匹配存放到数据库中，并且配备时间戳实现超时。
  + 如果一个帧到达端口X
    + 如果不在转发表中，广播
    + 如果映射到X，丢弃
    + 否则转发

+ 不同的局域网之间的设备

  + 集线器：物理转发，实现总线功能

    + 部署在星型布局中心

      接收帧后在其他所有线路上转发

  + 网桥：转发加地址学习

  + 2层交换机：连接主机或者局域网

    + 存储转发帧
    + 通过帧的MAC地址有选择地转发
    + 使用CSMA/CD访问控制
    + 透明
    + 即插即用
    + 连接更多的局域网

    网桥功能 + 可以连接更多主机/局域网 + 不发生碰撞

    + 好处
      + LAN和LAN之间交换
      + 交换机可以满足每个站点的容量
      + 可扩展性强，可以级联

  + 三层交换机

    + 随着二层交换机网络的扩张
      + 广播负载过重
      + 缺少多条路径通信手段
    + 通过IP层逻辑在路由器中实现
    + 将局域网转化为交换机连接的子网由路由器连接

+ 交换机网络

  + 交换机网络特点和优势
    + 专用链路
    + 交换器存储转发
    + 无碰撞
    + 全双工
    + 多个结点同时传输

+ 区别

  集线器：总线功能，只能实现物理转发，广播帧

  网桥：由生成树和端口学习算法，可以存储转发，连接不同协议的局域网

  二层交换机：具有网桥功能，可以连接更多局域网和主机，可以级联，不发生碰撞

  三层交换机：解决二层交换机广播负载过重的问题，拥有更强的路由算法，解决生成树算法不能多条路径通信的问题，可以在局域网之外的范围内通信



### WIreless and Mobile Network

+ 无线网络网络解决的问题

  + 无线链路通信
  + 移动用户可能会改变网络接入点

+ 无线网络的基本元素

  + **无线主机**

    电脑，智能手机

  + **基站**

    连接到无线网络的装置，负责在无线主机和无线网络之间传送分组

  + **无线链路**

    + 将移动设备连接到基站
    + 用于中枢连接

#### ==无线局域网==

##### ==IEEE 802.11体系结构==

+ Station（站点）

  符合802.11MAC和物理层的设备

+ AP（Access Point接入点）

  提供通过**无线媒介**到**分发式系统**的**接入服务**

+ BSS（Basic Service Set基本服务集）

  一个基本构件，包括一个接入点（基站）和一个或多个站点

  被一个AP协调的cell

+ ESS（Extended Service Set）

  被**分发式系统互联的多个BSS**。

  一个ESS看起来就像一个单独的逻辑上的局域网

  **路由器提供到因特网的接入**

+ DS（Distribution System分发式系统）

  一个被用来**互联BSS集**并且**整合局域网以构成ESS**的系统

  分发式系统可能是一个**交换机**，一个**有线网络**，或者**无线网络**。
  
+ 802.11b帧段

  **2.4GHz-2.485GHz**在频谱划分成11个信道

###### 802.11b 2.4GHz 11Mbps

###### 802.11g 2.4GHz 54Mbps

+ 802.11多路访问的问题

  + 隐藏终端
  + 信号衰减
  + 暴露终端

+ 

##### CSMA/CA

+ 主机和信道关联的方式

  + 被动关联

    1、AP**信标帧**

    2、主机关联请求帧

    3、AP关联回复帧

  + 主动关联

    1、主机广播**探查请求帧**

    2、AP**探查回复帧**

    3、主机请求关联帧

    4、AP关联回复

最短帧间距协调控制

优先级最高，立刻回复

###### 分布式协调控制DIFS

**中等长度帧间距**

分布式协调功能

用于**传输异步数据**优先级最低

###### 点协调控制PIFS

**最长帧间距**

通过**中心化的控制器轮询**

集中式控制

用于**发送实时数据**

优先级**仅次于控制帧**

###### **CSMA/CA算法**

+ 发送方

  1、如果感知到DIFS空闲，**在DIFS后**发送帧

  2、如果信道繁忙，就开始**随机时间回退**

  ​	当信道**空闲时候递减**该值

  3、计数值为0时，站点重发整个帧

  4、**收到ACK进入2发送另一个帧**，未收到选择**更大的范围内的随机值**进入2

+ 接收方

  1、如果接收没有问题，在**SIFS**后回复一个ACK
  
  

###### CSMA/CD和CSMA/CA的区别

+ 碰撞检测和碰撞避免的区别

  + 由于站点不具有同时发送和接收信号的能力

  + 由于隐藏终端和衰减问题无法检测所有的烹专

+ 它使用链路层确认方案，在SIFS后发回一个确认帧





## Chapter 3:Network Layer

#### 网络层服务

##### 交换/路由

+ 使用路由算法决定从源到目的地的（最短）路由路线

+ 设置路由器转发表

##### 转发

+ 从输入端口转发到正确的输出端口
+ 并且进行错误处理
+ 排队和调度

##### 在主机和路由器之间建立虚电路连接

+ 网络层服务模型

  尽力而为服务

  无带宽保证，不做无丢失保证，不能按序交付，没有时间保证，没有拥塞控制

+ 路由器容量

  $N \times R = capacity$

  外部端口的数量和每个端口的速率

+ 路由器输入端口查找转发端口匹配

  + 遍历

  + 建树

    几个bits画几层树，选择最后一次匹配的端口

+ 输出端口

  + 包分类

    根据源ip，端口号，服务类型，协议分类，分配到流

  + 缓存处理

    

  + 调度

    目的是快！

    + 优先级调度
    + 公平队列轮询
    + 加权公平队列按权重比例轮询

+ 交换结构

  连接输入端口和输出端口

  三种交换结构

  + 内存交换

    由cpu控制，限制于内存带宽

  + 总线交换

    通过共享的总线交换，限制于总线宽度

  + 互联网络交换

    克服了总线宽度的限制

##### 分组交换网络

+ 端到端的数据流被转化为**分组**

+ **应用**A，B的分组**共享**网络资源

+ **存储转发**

  分组一次移动**一跳**，在交换机中**缓存排队**

+ **资源**竞争

  突发状况下总资源量需求可能大于可用量

+ **拥塞**

  分组**排队**等待使用链路



+ 两种分组交换网络

  + 虚电路网络：ATM

    基于**分组的流**提供网络服务

    连接服务

  + 数据报网络：IP

    对**单个分组**提供服务

    无连接服务

  + 比较Internet vs ATM

    + **计算机**之间交换数据 vs 从**电话**演变而来

    + **弹性**服务，没有时间要求 vs 人类交流，有**严格**时间和可靠性要求

    + 聪明的**端系统**：可以适应、控制和差错恢复，简单的**网络内部**，复杂的网络边缘vs

      沉默的端系统，复杂的内部

    + 许多**链路种类** vs 单一链路种类

##### 分组交换网络中路由

###### 性能评估指标 



###### 路由信息的更新方式





IP协议

+ IP层位于主机和路由器上

  提供无连接服务

因特网寻址

+ 寻址等级

  + 物理因特网地址

  + 因特网地址

    在网络中路由PDU，每个端系统和介质系统有唯一地址

  + 应用层地址

    进程ID

+ 寻址模式

  +　单播寻址
  +　广播地址
  +　多播地址
  +　任播地址
  

　### IP操作

#### 路由

##### 路由表

+ 作用

  表明下一跳分组应当如何转发

+ 分类

  + 静态路由表
  + 动态路由表

+ 路由算法

  距离向量，路径状态和路径向量

##### 数据报的生命周期

+ 原因

  数据报可能无线的在网络中循环

+ 数据报被生存周期标识

  IP：TTL(Time to Live)

  TTL耗尽，数据报在转发时被丢弃

+ 生存周期种类

  跳数——每经过一个路由器TTL减一

##### 数据报分片

+ 原因

  数据报长度大于MTU(max transmission unit)

+ 何时分片

  主机：根据路径上的MTU分片

  路由器：超过下一跳的MTU分片

+ 何时聚合

  目的主机（路由器不适合做这件事因为可能会分片后选择不同的路由）

##### 错误控制

+ 无交付保证
+ 路由器在丢包时发送控制报文通知源
+ ICMP报文用于错误信息
+ 源收到信息交付给更上层处理

### IP 报文结构

#### 报文头部

| Version                     | 4 bits      | 4                                               |
| --------------------------- | ----------- | ----------------------------------------------- |
| IHL(Internet Header length) | 4 bits      | 按4字节单位计数                                 |
| Type of service             | 8 bits      | 优先级3bits + 可靠性1bit + 延迟1bit +吞吐量1bit |
| Total length                | 16bit5      | 数据报长度，以字节为单位                        |
| Identification              | 16bits      | 顺序编号                                        |
| Flags                       | 3 bits      |                                                 |
| Fragmentation offset        | 13 bits     |                                                 |
| Time to live                | 8 bits      |                                                 |
| Protocol                    | 8 bits      | 传输层的协议类型                                |
| Header checkSum             | 16 bits     |                                                 |
| Source addr                 | 32 bits     |                                                 |
| Dest addr                   | 32 bits     |                                                 |
| Options                     | <= 40 bytes |                                                 |
| Padding                     |             | 32bit对齐                                       |
|                             |             |                                                 |

+ 默认IP报文头部为20字节

#### 数据部分

+ 按字节对齐
+ 最大长度（包括报文头部）为65535字节

### IP原语

#### Send

+ 由上层调用

  请求数据传输

#### Deliver

+ 通知上层

  通知使用者数据单元到达

#### 参数

用于传输数据和控制信息

### IP分片

报文大小超过MTU，需要路由器分片

#### 分片的位置

路由器

#### 重新聚集

#####  位置

目的地

##### 依据

IP头部比特用于辨别，确定序列

##### 具体字段

###### Identifier（16 bits）

端系统辨别来自同一个数据报

也使用源地址和目的地址

###### Date Length

以字节为单位表明**包括头部**的报文长度

###### offset（13 bits）

分片在源数据报的偏移量

按照**8字节**的倍数计数

（13 + 3 = 16）

###### flag（3 bits)

指明是否为最后一个片

比如不是最后一个片moreflag = 1，否则为0

#### 如何分片

比如有一个4000bytes的报文

+ 取出20bytesIP首部，对3980的数据部分分片（包括更上层的报文首部也被分片）
+ 3980 = 1480 + 1200 + 1300
+ 1480 + 20 = 1500
+ 1200 + 20 = 1220
+ 1300 + 20 = 1320





### IP地址

#### 定义

+ 32bits分配给每个接口(interface)的全局地址
  + 高位：网络部分
  + 低位：主机部分

#### IP子网（岛、物理网络）

+ 含义

  分开主机和路由器的每个**接口**，产生几个**隔离的网络岛**，用**接口端接这些隔离的网络的端点**，这些隔离的网络的每一个都叫作一个子网

  子网内可以互相通信而不通过路由器
  
+ 用于解决IP地址不够分配的问题

+ 主机地址被子网掩码划分为子网号和主机号

+ 每个局域网被分配一个子网号

+ 本地路由器在子网中路由

+ 每个子网在因特网中看起来像一个单独的网络

#### IP地址的表示

点分十进制



#### IP地址的划分

##### IP地址的编址策略（早期）A、B、C和D类网络(0,10,110,7,14,21)

###### A类网络

| 0    | NetWork 7bits                       | Host 24bits          |
| ---- | ----------------------------------- | -------------------- |
|      | 全0保留，全1做回环测试本地网卡1~126 | 全0和全1扣除 2^24^-2 |

###### B类网络

| 10   | NetWork（14bits）      | Host(16 bits) |
| ---- | ---------------------- | ------------- |
|      | 128.0~191.255（2^14^） | 2^16^-2       |

###### C类网络

| 110  | Newtork（21bits)             | Host(8 bits) |
| ---- | ---------------------------- | ------------ |
|      | 192.0.0~223.255.255（2^21^） | 2^8^-2       |



##### IP地址的分类策略：CIDR

Classless Interdomain Routing ：无类别域间路由

a.b.c.d/x

+ 高x比特：网络部分/前缀

  可以减少转发表的长度

+ 剩余的32 -x比特

  区分内部设备

###### 子网聚集

又利用更有效率的路由

### NAT

#### 含义

+ 内部和外部流量采用不同的IP地址集合
+ 在接口处地址转换为外部网络地址

#### 好处

+ 专用网络的地址被NAT路由器转换为一个只有单一IP地址的专用设备
+ 作为**防火墙**隐藏内部网络的细节
+ 公网地址和私网地址在更新时**独立**

#### 坏处

+ 破坏网络的层次性
+ 在执行P2P应用时，NAT主机无法直接发起连接，需要借助超级节点，此时需要建立两条连接

#### 类别

##### 静态NAT

##### 动态NAT

##### 单一地址NAT

###### NAPT

将源IP和端口号映射到一个新的IP和端口号上

### ICMP

#### 位置

封装在IP数据报中

#### 协议号：1

#### 功能

在主机和路由器间发送**错误**和**控制**信息

#### 格式

| Type   | Code   | Checksum |
| ------ | ------ | -------- |
| 8 bits | 8 bits | 16 bits  |

#### Ping的实现原理

##### 目的

确认目的主机**可达**

计算往返**时延**

计算目的地的**跳数**

##### 过程

源发送回显请求(echo request)

目的地发送回显恢复（echo reply）

#### Traceroute实现原理

##### 目的

追踪源到目的地的路由，获知跳数，往返时延，路由器名称和地址

##### 过程

路由器发送携带不可达UDP端口号的普通IP数据报，TTL设置为1、2、3，并且维护定时器

TTL=0时路由器发送TTL expired报文给源主机

ps.可能在动态路由中失败

#### minimum MTU

##### 过程

源发送很大的IP数据报不做分片

路径上的路由器返回parameter unintelligible报文

源调整减少报文的大小，直到不出错的阿松到目的地

### 移动IP

#### 移动节点

可能会更改接入点的主机

#### 通信节点

向移动节点发送报文的主机

#### 归属代理

归属网络结点，维护注册的移动结点

#### 外部代理

外部网络的路由器，帮助一个移动结点

#### 三角路由

通信节点向移动节点发送报文

归属代理拦截报文转发外部代理

移动节点直接向通信节点恢复

#### 发现

外部代理发送ICMP代理广告或者移动节点发起请求

#### 注册

表明地址关心

向归属代理请求转发

##### 过程

移动节点发送外部代理注册请求

外部代理转发给归属代理

归属代理发送注册回复

外部代理转发给移动节点

#### 管道

连接归属代理和移动节点

归属代理广播ARP请求将移动IP和归属代理MAC地址关联

### IPv6

#### 原因

IPv4地址耗尽

速度控制和转发

提高QoS

不需要分片

#### 报文头部格式

40 bytes

| Version         | 4 bits   | 6                                                            |
| --------------- | -------- | ------------------------------------------------------------ |
| Traffic Class   | 8 bits   | QoS（不同的流量，看电视，打游戏）由上层交付，路由中可以修改  |
| Flow Label      | 20 bits  | 标识流（由相同的传输要求，可能包括多个TCP连接，一个应用可以产生多个流） |
| Payload Length  | 16 bits  | 包括扩展头部和数据部分全部                                   |
| Netheader       | 8 bits   | 扩展头部                                                     |
| Source/Dst addr | 128 bits |                                                              |

##### 扩展头部

路由，分片，逐跳处理，安全验证等等

##### 分片

IPv6不做分片，主机自己分

##### 广播

IPv6不做广播

可能惊醒很多结点，资源浪费，广播风暴

##### 邻居发现

IPv6不做ARP

用Neighbor Discovery解决

还可以测试可达性和地址

##### IPv6地址

###### 单播

###### 任播

###### 多播

###### IPv4->IPv6地址

::a.b.c.d

##### IPv4到IPv6的区别

###### 长度

20->40

###### 地址

32->128

###### 分片和可选项(Options)

删除

###### 检验和

删除

###### 报文长度

首部固定，只包括扩展包头和载荷

###### TOS->Traffic class

###### Protocal->next header

###### Time to live->Hop limit

###### 32位对齐->64

##### 与IPv4的优点

###### 地址

扩展地址范围

多播和任播

地址自配置

###### 扩展首部字段

分离可选包头部分

可扩展性增强

###### 删除检验和

提高效率

###### 优化资源分配

Traffic class 和 flow 成组

###### 效率和安全

提高处理效率，更强的IP加密和认证计数

##### IPv4到IPv4

###### 路由器双栈处理

转换损失IPv6字段

###### 建隧道

将整个IPv6报文放到一个IPv4数据报中

效率较低但不损失信息

### 路由算法

#### 服务对象

##### 分组交换网络

建立路由表

##### 虚电路网络

建立连接选路和建立路由表

#### 路由性能标准

##### 最小跳数

##### 最少代价

###### 决定代价的因素

最小时延，最大吞吐量

#### 路由时机

###### 分组交换网络：分组

###### 虚电路网络：虚电路建立之初

#### 路由位置

##### 集中式

##### 源端点

##### 分布式

#### 路由信息的更新方式

##### 信息来源

本地信息，相邻交换机，网络中的所哟交换机

##### 更新时机

周期性

发生改变

#### ==集中式路由==

一个单独的固定的路由器根据全局状态信息路由

#### ==分布式路由==

##### 洪泛

不需要状态信息，分组从各个接口转发出去

可能导致重复和循环

##### 随机路由

不需要状态信息，随机挑选一个接口转发出去

强连接网络，无优化性可言

##### 自适应路由

需要状态信息

权衡网络质量和开销

存在拥塞控制

可以考虑队列长度和bias

#### 最少代价路由算法

##### Dijkstra算法：集中式链路状态 ：LS

给定源点到所有点的最短路径

N= 点的集合

s = 源点

T = 已经考察的点

w(i,j) = i到j的代价

L(n) = 从源点n的最短路径代价

###### 过程

初始化T= {s}, L(n) = w(s, n)

| T    | L(2) | Path | L(3) | Path | L(4) | Path | L(5)     | Path |
| ---- | ---- | ---- | ---- | ---- | ---- | ---- | -------- | ---- |
| {s}  | 2    | 1-2  | 5    | 1-5  | 1    | 1-4  | $\infty$ | -    |
|      |      |      |      |      |      |      |          |      |

###### 复杂度分析

n平方，或者nlogn

###### 可能的问题：震荡

解决方法：不要让所有结点同时运行路由算法

##### Bellman-Ford算法：分布式、迭代、异步距离向量算法：DV

###### 距离向量

$D_x = [D_x(y)：y \in N]$

对**每个结点**维护一张路由选择表，自己的那一行代表计算结果，另外的标识从邻居接收到的距离向量

###### 可能的问题

路由选择环路

解决方法：毒性逆转

如果z通过y到达x,那么z向y撒谎，到x的距离为无穷

##### 两个算法的区别

状态洪泛，全局信息，集中式，不能处理负值，收敛较快，错误范围小，健壮性好

距离向量，局部信息，分布式，收敛较慢，可能产生环路，错误可能会在网络内传播

#### 链路代价的计算

##### 路由器输出接口队列长度（早期）

##### 测量时延（现代）

包括了排队、传输和传播时延

有利于解决LS算法震荡问题

###### 用时延计算链路利用率

$$
T_s = {报文长度(600bits) \over 传输速率}
$$


$$
\rho = 2 {(T_s - T) \over (T_s - 2T)}
$$

###### Leveling

$$
U_n = \alpha \rho _n + (1-\alpha) \times U_{n-1}
$$





### 层次路由

#### 原因

###### 规模太大导致开胸啊太大

###### ISP希望自治

#### AS自治系统

处于相同组织管理下的路由器

由唯一AS号标识

内部路由器运行相同的路由算法

网关路由器运行域间和域内路由算法

#### IGP域内路由协议

关注路由算法效率，在不同AS间不同

##### RIP:距离向量算法

UDP packet，在应用层实现

距离向量标准：跳数，后来考虑了队列长度

##### OSFP：链路状态算法

IP packet，Not UDP

在每个路由器计算SPF tree，但只是用下一跳的信息

###### OSFP的优点

1、**安全**

2、允许使用**多条路径**

3、对**单薄和多播**的综合支持

4、支持**层次结构**

主干区域连通下层区域，洪范信息只在每一个区域

主干区域0.0.0.0

#### EGP域间路由协议

政策比效率更重要，获取可达性信息

##### BGP（边界网关协议）

###### 要求

不同的AD

###### 不适用LS和DV

LS：洪泛

DV:无法知道沿路的AS

###### Path-Vector

###### 功能

将不同ISP的AS粘合起来

基于策略和可达性信息路由

###### 连接

TCP

在AS内两台路由器的BGP会话：内部BGP连接iBGP

在AS间边界路由器的BCP会话：外部BGP连接eBGP

###### 协议内容

Open：建立BGP连接

Notification：报告异常信息

Update：通知邻居信的路由器或旧的路由器断开

Announcements, Withdrawal

Keep-alive：通知邻居连接仍存在

###### 工作方式

每个网关路由器向另据通告前缀的可达性信息，并且包括到目的地的整个路径，包括路径和代价

可以让路径不穿过某些AS，选择经过最少的AS等等

##### BGP Business

AS拓扑体现了AS之间的商业关系

###### peer to peer

###### Customer pays provider

##### BGP和DV的区别

路由：BGP选择根据最佳路由而不是最短路径

​			除了距离，BGP发送整个路径的信息可以用于防止环路和根据策略路由

可达性：BGP可选的进行可达性的广播

​				BGP可以聚合多个前缀



## Chapter 4：TransportLayer

### ==传输层服务：编址，复用，流控制，面向连接，可靠服务==

#### 编址

端口号实现应用进程多路分解和复用

###### 套接字

**应用进程**和**操作系统**交换网络**信息**时的**软件抽象**

###### 传输层地址（套接字）

**<HostIp, Port>**

###### 端口号

16bits用于分辨应用进程

0~1023为**周知端口号**

OS负责将端口号映射到套接字

+ UDP：local IP, local Port

  所以来自于不同源端口号和主机的报文会分解到同一个套接字上

+ TCP：local&remote IP, local&remote Port

  比如Web服务器，虽然目的IP和目的Port：80相同，但是会创建多个线程对应多个套接字

#### 复用

将应用信息划分为报文段推向网络层

将报文段聚合推向网络层

##### 多路复用(Mux)

将不同应用的数据（从不同的套接字发送）结合为数据块传向网络层

##### 多路分解(Demux)

将数据从多路复用流中提取出来发送到套接字

主机通过IP 地址和 端口号将报文段映射到套接字

#### 流控制

#### 面向连接

提供不同主机应用进程之间的逻辑连接

#### 可靠传输

提供可靠的端到端服务

可靠的，按序交付的，Well-paced服务

##### 报文出错：ACK/NAK&序号

接收方回复ACK/NACK

如果ACK/NACK出错，需要用序号标识报文检测重复

##### 报文丢失：计时器

如果超时未ACK，重传

### 为什么需要传输层

#### 进程通信

IP层只提供了主机通信

#### 可靠服务

IP层只提供了尽力而为服务

### 可靠传输协议设计

#### Stop and Wait

RTT = 2 * PropDelay(Round TripTime)

t = 0开始传输， t + L / R传输结束，arrive + L/R接收结束，回复ACK，t + L / R + RTT收到ACK

吞吐量：DATA / ( L / R + RTT)

利用率
$$
L / R \over {L / R + RTT} 
$$


####  提高效率：流水线协议

##### 要求

增加序列号的范围

在发送方和接收方维护缓存

##### 哪些报文会被发送方发送：滑动窗口

滑动窗口又被称作：正在传输，未确认的报文

###### 吞吐量

$$
Min\{ n * DATA / RTT, Link Bandwidth\}
$$

如果n增加，那么吞吐量增加，但是也会影响丢包率

##### 接收方如何确认报文？

###### 累积确认

接收方ACK下一个想要接收的报文

###### 选择确认

接收方独立的确认正确收到的报文

###### 比较

选择确认提供了更加简单的信息

但是需要更加复杂的缓存维护

##### 发送方如何重发报文？

###### Go-Back N

发送方一次重传n个报文

接收方采用累积确认，只按序确认报文，丢弃不按序到达的报文

###### Selective Repeat

发送方重传未确认的报文

###### 比较

选择重传效率更高但是维护更复杂，需要维护每个分组的计时器

###### 适用场景

错误率很高的时候，SR + 选择确认

错误率比较低，Go-Back-N + 累积确认

### UDP：User Datagram Protocol

轻量级的进程通信

#### UDP服务

##### ==无连接服务==

###### 无握手过程

###### 每个报文段单独处理

##### ==“尽力而为”不可靠服务==

###### 丢包

###### 乱序交付

#### UDP应用

##### 流媒体

##### DNS

##### SMTP

#### 优点

##### 无连接建立：快速

##### 无连接状态：简单

##### 无连接首部：轻量级包头

##### 无拥塞控制：可以有很大突发流量

#### 报文格式

| Source / Dst Port | length                    | checksum                       |
| ----------------- | ------------------------- | ------------------------------ |
| 16bits            | 16bits 包括包头和数据部分 | 16bits（首部+数据+**伪包头**） |

##### 伪包头

| src / dst IP | pad    | proto  | total length               |
| ------------ | ------ | ------ | -------------------------- |
| 32 bits      | 8 bits | 8 bits | 16bits（和UDP length一致） |

##### 检验和计算

注意最高位的进位要会卷到最低位

##### 可选实现

源端口可以缺省

检验和可以缺省

### TCP：Transmission Control Protocol

#### TCP基本服务

##### 可靠服务

##### 按序交付服务

##### 字节流传输

#### 协议首部格式

$ \ge 20 bytes$

| Src/Dst port | Sequence Number   | Acknowledgement | Checksum     |      |
| ------------ | ----------------- | --------------- | ------------ | ---- |
| 16 bits      | 32 bits（按字节） | 32bits          | 伪包头和数据 |      |

##### Sequence Number

报文段数据部分第一个字节的序号 = ISN + k（k是已经传输完毕的字节数目）

##### ACK sequence number

= 下一个期待到达的字节序号

（到达的分组会被缓存下来，采用累积确认，请求下一个期待的分组）

（每次收到报文都会ACK一下）

##### HdrLen

以4字节为单位标识首部长度

#### 快重传机制

在收到重复ACK的时候重传对应的报文（在计时器超时机制触发之前）

#### 超时机制

##### Go-Back-N

TCP维护唯一的计时器，也就是**Go-Back-N**重传机制

##### 重传时间

重传时间根据RTT决定

##### Karn/Partidge 算法：加权平均

###### RTT的测定

指数平滑均值
$$
EstimatedRTT = (1 - \alpha)EstimatedRTT + \alpha SimpleRTT
$$

+ 不适用重传得到的SampleRTT
+ a = 0.125

###### RTO的计算

Timeout = 2 * EstimatedRTT

每次超时，指数退避，RTO = 2*RTO

一旦成功传输，RTO结束退避，重新设置 2 * EstimatedRTT

##### Jacobson/Karel 算法：偏差计算

$$
Deviation = | SampleRTT - EstimatedRTT |
$$

$$
DevRTT 是Deviation的指数加权平均数
$$

$$
RTO =EstimatedRTT + 4 \times DevRTT
$$




#### TCP报文段

##### MSS

MSS = MTU - IP header - TCP header  = 1500 -20 -20 = 1460

#### TCP连接管理：建立连接

#### 两次握手

A send SYN

B replies SYN

通过重传处理丢包

忽略重复的SYN

##### 问题

+ 区分上一次链接的报文

  **Initial Sequence Number(ISN)**

  每一次连接从一个和之前的序列号差异很大的初始序号开始

+ 分辨重复过期SYN

  但是过期的SYN可能传递过期的初始序号导致连接失败

#### 三次握手

##### 过程

1、A send **SYN**（SYN = 1,A初始序号）

2、B return **SYN ACK**（SYN = 1，ACK sequence：A ISN + 1, B初始序号）

3、A send **ACK**（SYN = 0，ACK sequence：B ISN + 1）

##### TCP首部字段

SYN，ACK

##### 如果三次握手中出现丢SYN包

发送方在超时后重传

默认3秒

##### 如何处理SYN丢包

超时重发

放弃连接，重新创建套接字发起另一个连接

#### TCP连接管理：连接终止

##### 四次挥手

A send FIN

B reply ACK

连接半关闭

B send FIN

A reply ACK

A 进入TIME_WAIT：如果ACK丢失，B会重传(30s关机)

#### TCP连接管理：突然终止

A 发送 RST终止

如果B未接收到 RST 继续发送，A会重传RST



### TCP流控制

#### 信用量机制

###### Advertised Window(RWND)

接收方在ACK时使用**Advertised Window**域发送RWND防止发送方溢出接收方缓存

###### RWND

$$
RWND = Buffer - (LastByteReceived -LastByteRead)
$$

###### 信号量分配死锁

如果重启接收窗口的报文丢失发生死锁

可以采用定时器定期重发报文

### TCP拥塞控制

#### TCP拥塞控制的原因

不需要更新硬件，只需要修改TCP实现的代码

可扩展，可更新

#### 拥塞控制设计关键

##### 如何检测拥塞

##### 谁关心拥塞

端系统

##### 如何处理拥塞

持续适应

#### 拥塞控制

拥塞控制是一个与流，链路，复杂的动态信息相关的资源分配问题

#### 发送速率

$$
Window / RTT
$$

可以通过控制滑动窗口的大小控制发送速率

#### 拥塞窗口

$$
Sender-side window = min \{CWND,RWND\}
$$

通常情况下RWND远大于CWND

##### 拥塞窗口的单位

CWND的单位通常为MSS

(真实世界中按字节实现)

#### 如何检测拥塞

##### 时延

不好，影响因素太多

##### 路由器告知

##### ==丢包率==

###### 冗余ACK：轻度丢包

###### 超时机制：严重丢包

#### 慢启动

用于测定带宽

##### 初始化

CWND=1

初始吞吐率为MSS/RTT

##### 慢启动

如果不发生丢包在一个RTT后翻倍

或者说，**每次收到一个ACK后++**

##### ssthresh

初始化为一个很大的值

如果CWND > ssthresh，慢启动结束

#### 拥塞避免：AIMD（Additive Increase Multiplicative Decrease）

##### 加性增

如果CWND > sshthresh

平均每次ACK，CWND = CWND + 1/CWND

**实际上CWND在接收到了所有报文段后才++**

##### 乘性减

###### 如果发生了3次冗余ACK

ssthresh  = CWND / 2

CWND = ssthresh

进入拥塞避免

###### 如果超时事件发生

ssthresh = CWND/2

CWND = 1

从慢启动开始

#### 快速恢复

在发生了冗余ACK的事件之后

CWND = CWND / 2 + 冗余ACK的数目，之后每收到一个冗余ACK, CWND++，直到成功发送

CWND恢复到之前拥塞避免状态的要求

#### TCP拥塞控制的优点

##### 探查瓶颈带宽

##### 共享带宽

###### 高利用率

###### 公平分配

#### TCP吞吐量

$$
A = {3 \over 8}W{max}^2
$$


$$
p = {1 \over A}
$$

$$
Throughput = \sqrt{3\over 2}{1 \over RTT \sqrt{p}}
$$
说明RTT越小，吞吐量越大

### 路由器协助的拥塞控制

#### 抑制分组

拥塞结点向源结点发送一个ICMP报文抑制分组

#### 反压

长距离网络或者告诉网络

逐跳抑制，要求每一个路径上的结点降低传输速率

#### 警告位（ECN）

由阻塞的路由器设置

如果发送的报文设置了ECN，相应的ACK报文也会有

###### 优点

不会和错误弄混

可以作为早期的拥塞检查

很容易部署在网络中

#### 随机早期丢弃（RED）

路由器在队列完全满之前开始丢包

###### 优势

可以防止TCP进入慢启动

可以让不同连接的流量交错，不会同时进入慢启动，提高利用率

###### 计算平均队列长度

利用指数平滑加权均值

#### 公平

##### 最大-最小公平

路由器公平的对流服务、

###### 计算

将带宽C先平均划分给N个需求对象，如果可以满足最小的需求，那么先分配给最小的用户，将剩下的带宽重新分配

如此往复即可

###### 特点

如果一个个用户不能被满足，那么没有人可以得到比他更多的带宽

##### 公平队列

期望比特服务

但是可以先按照比特服务算出来它们离开路由器的时间，按照先后顺序排列

#### 公平队列和FIFO的区别

##### 优点

不需要欺骗流

带宽不会因为由RTT决定

流可以选择调整速率

##### 缺点

实现更加复杂

公平队列不会消除拥塞

它只能管理拥塞

## 网络安全

### 网络攻击的分类

#### ==主动攻击==

##### 伪装

假扮为另一个实体

##### 重放攻击

拦截报文重新传输

##### 修改报文内容

##### Dos

拒绝服务攻击

##### 很难预防

##### 可以被检测

#### ==被动攻击==

##### 监听报文

监听和记录在信道上传输的报文内容

##### 流量分析

分析主机之间的报文频率和长度

##### 难以检测

##### 可以被预防

### 安全通信要求

#### 可用性——干扰

#### 机密性——窃听

#### 完整性——修改

#### 可认证性——伪装

### ==加密机制的元素==

#### 密文

#### MAC

Message Authentication Code

报文鉴别码——防止修改报文

#### 签名

防止被伪造

#### 对称密钥

#### 公钥加密

### 密钥的要求

#### 强加密算法

无法通过明文，密文对解开密钥

#### 安全分发密钥

### 密钥攻击

#### 密文攻击

#### 明文攻击

拥有对应密文的明文

#### 指定明文攻击

拥有指定明文的一段密文

### 传统加密技术

##### 替换算法

###### 凯撒密码

###### 单码代替密码

###### 维吉尼亚密码（多码代替密码）

在不同位置出现采用不同的单码

##### 置换算法

###### 篱笆密码

按行写成矩阵

按列编码

###### 行列密码

采用Key的顺序对列读取

### 现代加密技术

### 块加密

##### 常用算法

###### DES，TDES,AES

将加密的报文处理为k比特的块，对每个块做一对一映射

### 非对称加密技术

#### 公钥和私钥

私钥被A私密的拥有

公钥被A公开

#### 加密和解密

加密需要两者之一的密钥

解密使用另一个密钥

#### 要求

##### 算法周知

加密和解密算法是周知的

##### 私钥

已知公钥和算法，难以找到私钥

已知密文和明文对，很难找到私钥

##### 明文

知道密文很难找明文

#### 密钥生成

##### p、q

找到一对大素数

##### N

N = p * q

##### 欧拉数

(p - 1) * (q - 1)

##### e，d

和欧拉数互素的数字e

e * d mod 欧拉数 = 1

##### 公钥：e, N

##### 私钥：d,N

#### RSA加密和解密过程

##### M < N && C < N

##### 加密

$$
C = M^emod N
$$

##### 解密

$$
M = C^dmod N
$$

#### RSA算法设计因素

##### p和q

长度相近,不相关

##### e

相对小

##### d

很大（不会被通过蛮力破解）

#### RSA算法的强大依赖于大素数分解的困难性

#### RSA算法的应用

##### 数字签名

私钥加密明文，发送明文和密文用公钥验证

##### 对称密钥分发

公私钥技术计算量大，缓慢

### 端点鉴别

#### ap1.0：声明

I an Alice

##### 攻击

Trudy可以宣称自己是Alice

#### ap2.0：IP

I am Alice and My IP address is...

##### 攻击

模仿Alice的IP

#### ap3.0：password

I am Alice and my IP and **secret password**

##### 攻击

重放攻击

#### ap3.1

加密了密码

##### 攻击

重放攻击

#### ap4.0：不重数

B发送给A不重数

A用对称密钥加密不重数发送

##### 攻击

对称密钥分发由风险

#### ap5.0：不重数+公私钥

A用私钥加密不重数，B通过公钥接出不重数

##### 攻击

中间人攻击，Trudy截获A的公钥并且将自己的公钥发送给B

#### 报文鉴别的要求

##### 端点鉴别



##### 报文完整性

###### 鉴别密钥

用于防止伪造报文鉴别码

###### 报文鉴别码

#### 需要解决的安全问题

##### 伪装源端点

##### 报文修改

##### 报文重放

#### MAC鉴别

MAC是一个在报文后的固定长度的编码，64~256bits，是单向的，不需要解密

#### 报文鉴别码生成的可能方式

##### 密钥加密

###### MD5,SHA-1

###### 用鉴别密钥s级联报文计算散列，发送扩展报文m , H(m + s)

###### 接收方用鉴别密钥计算MAC比较

##### 哈希函数

### 数字签名

用私钥对MAC加密，接收方用公钥解密

可以提供端点鉴别

#### 密钥分发

##### 使用场景

###### MAC鉴别密钥

###### 公钥分发

##### 分发攻击

###### 重放冲击

###### 中间人攻击

##### Diffie-Hellman 密钥交换

1、选择较大的素数P

2、选择0~p-1的数g

3、A选择0~P-1的较大的随机数X
$$
g^Xmod P
$$
4、B选择0~P-1的较大的随机数Y
$$
g^y mod P
$$
5、AB共享密钥
$$
g^{xy} mod P
$$

### 公钥认证（CA）

#### 会话密钥

只用于逻辑连接中

#### 永久密钥

用于密钥分发

#### 密钥分发中心（CA）

###### 证书

CA 将特定实体和公钥绑定，证实发送方和接收方的身份

用户ID和公钥

提供会话密钥

#### 一次性会话密钥

将messege + 公钥 + 公钥加密的一次性会话对称密钥发送

#### 公钥证书正确性的验证

1、A将证书发送给B

2、A将证书哈希后发送给CA

3、CA用私钥加密

4、B用公钥解密验证证书

#### 安全电子邮件

##### A向B发送机密邮件

1、A用B的公钥加密对称密钥

2、A用对称密钥加密报文

3、B用B的私钥得到对称密钥

4、B用对称密钥得到报文

##### A向B发送可鉴别的完整报文

1、A用函数H生成MAC并使用私钥进行数字签名

2、A发送完整明文报文

3、B用A的公钥解出MAC并计算明文报文的MAC比较

##### A向B发送，完整，可鉴别以及机密报文

1、A先生成数字签名得到扩展报文m + H(m)

2、A用对称密钥加密扩展报文

3、A用B的公钥加密对称密钥

4、B用对称密钥解密报文

5、B计算MAC验证鉴别码

### 传输层安全协议——SSL(Secure Socket Layer)安全套接字层

#### TLS（Transport Layer Security）传输层安全性

#### SSL提供的服务

###### 机密性

###### 数据完整性

###### 服务器鉴别和客户鉴别

#### SSL的位置

位于TCP和应用程序之间，是一个传输层协议

#### 过程

##### 分割

SSL将字节流分割成记录，加密”记录+ MAC“

##### 序号

SSL通过序号并且把序号和数据一起散列得到MAC来防止重放攻击

##### 密钥

包括会话加密密钥E和会话鉴别密钥M

会话加密密钥只对数据和MAC加密，不对头部字段加密

##### SSL握手

1、客户发送**算法列表**和客户端**不重数**

2、服务器返回选中的算法，**证书**和**服务器不重数**

3、客户**验证证书提取公钥**，生成**前主密钥（PMS）**并用公钥加密发送

4、客户和服务器独立的从PMS和不重数中提取出主密钥（MS），**切片为两个密码和MAC密钥**

5、客户端发送**所有报文MAC**（包括发出的，收到的）

6、服务器发送MAC（包括收到的，发送的）

（不重数用于防止连接重放，序号防止分组重放）

### IP层安全协议——IPSec

#### 创建虚拟专用网VPN

在进入公网之前私用网络的数据报加密

#### 传输模式

端到端之间

不更换IP包头，直接插入IPSec包头

#### 管道模式

防火墙之间

将IP包头和数据部分一起加密，插入新的公网IP包头

#### 安全关联（SA）

发送数据之前需要建立安全关联

##### SA是单向的

### WIFI 802.11i 

使用AP之外的认真服务器

提供密钥分发机制

强加密形式

##### 过程

1、客户端通过AP发现AS（认证服务器）

2、客户端和服务器互相认证，产生对称密钥，AP只负责经过

3、AS发送对称密钥

4、客户端和服务器产生临时密钥

### 防火墙

#### 目标

##### 连接

将组织内部的网络和公网隔离开来

##### 安全

防止外部的黑客和干扰程序，确保内部网络安全

#### 功能

##### 防止DoS攻击



##### 只允许认证网络连接

##### 防止非法访问和修改内部数据

#### 类别

##### 无状态过滤报文

根据源/目的IP过滤报文，根据端口号过滤报文，过滤ICMP报文，过滤TCP SYN和ACK

##### 有状态过滤报文

##### 应用网关

#### 实现

路由器可以用访问控制里列表实现防火墙规则

## 应用层

### 应用

正在**通信**的**分布式进程**

### 应用层协议

#### 应用程序的“助理”

#### 定义应用程序交换的报文格式和行为

#### 使用下层的通行服务

### 进程

通讯发起的主体

### User-agent

#### 由用户接口和应用层协议实现

###### browser

###### mail reader

###### player

### 应用层协议的内容

#### 报文类型

#### 报文语法

#### 报文语义

#### 发送/回复行为规则

### 应用层结构模型

是否在线

如何请求服务/提供服务

IP地址

#### client-server

##### client

###### 需要时启动

###### 主动和服务器建立连接

###### 移动IP

##### Server

###### 后台驻留

###### 提供被客户端请求的服务

###### 固定IP

#### peer-to-peer

##### 无需服务器一直在线

##### 主机向其它主机请求服务——自增长

新的主机加入网络会带来新的网络容量和新的网络需求

##### 主机会间隔的连接并且交换IP

### DNS

#### 功能

将域名转化为IP地址

#### 域名系统

##### 分布式数据库

###### Q：为什么不使用集中式DNS

​	不可扩展，容易失败，流量过大，维护困难

在域名服务器实现分布式数据库

##### 应用层协议

应用层协议主机和域名服务器交互来解析域名

##### 负载均衡

域名服务器的IP地址集合

### 实现目标

#### 独特性

#### 可扩展性

#### 分布式，自治式管理

#### 适应性的

#### 快速查找

#### 完美一致性

### 层次化DNS系统

#### 层次化域名空间

##### 顶级域名

edu.

##### 域名是从叶节点到根节点

##### 树的深度是随意的

##### 避免了名碰撞

#### 层次化管理

#### 层次化服务器

##### 根域名服务器

根域名服务器知道顶级域名路由器

13

##### 顶级域名服务器

com. org, net, edu, aero, jobs

##### 权威DNS服务器

组织自己的服务器

提供权威主机名和IP的映射关系

##### 本地域名服务器（默认服务器）

不严格属于层次结构

DNS请求发送给本地域名服务器

### DNS解析

#### 迭代式请求

直接连接服务器用下一个服务器的域名回复

#### Host-Server：迭代请求

#### Server-Server：一步请求

本地服务器->root -> 顶级域名 -> 权威服务器

### DNS缓存

缓存可以大量减少开销

本地DNS服务器常常缓存信息

维护TTL超时

### 电子邮件

#### SMTP：Simple Mail Transfer Protocol

#### MIME：Multi-purpose Internet Mail Extension

#### POP：Post Office Protocol

#### IMAP：Internet Mail Access Protocol

对服务器中存储的信息操作

#### 电子邮件系统系统的组成结构

##### 用户代理

###### 编辑和阅读邮件信息

###### 发送和接收服务器中的邮件

##### 邮件服务器

###### 容纳来的邮件的邮箱

###### 维护送出的邮件队列

###### 在服务器间运行SMTP协议

#### 邮件递送的三个阶段

##### 第一阶段

从本地用户代理发送邮件到本地服务器

用户代理：SMTP客户端

本地服务器：SMTP服务器

##### 第二阶段

从本地服务器发送邮件到远程SMTP服务器

##### 第三阶段

远程用户代理使用邮件接入协议从远程服务器邮箱获取邮件

###### POP3 or IMAP4

#### 一个邮件传递情景

Alice编写邮件

Alice发送到UA使用SMTP进入队列

客户端建立TCP连接

SMTP客户端通过TCP连接发送邮件

Bob邮件服务器将邮件存储在邮箱中

Bobo使用Pop3协议从UA中读取邮件

#### SMTP

##### TCP Port 25

##### 不会负责邮件信息或者数据转换

##### 过程

###### 握手

###### 传输一个或多个邮件

###### 终止连接

##### 命令/回复 交流

###### 命令

Commands：ASCII text

Response：状态码

##### 可靠性分析

依靠TCP连接

丢失的邮件不做保证

无端到端ACK

#### POP

##### TCP，110

服务器特许用户，事务处理和更新

##### 特许（认证）阶段

###### 用户命令：user,pass

###### 服务器回复：+OK, -ERR

##### 数据处理阶段

###### list：列出邮件数目

###### retr：通过邮件序号取回邮件

###### dele：删除邮件

###### quit

##### 状态

###### 下载并删除

###### 下载并保留

###### 无状态的

#### IMAP

###### 有状态的

###### 邮件保存在服务器中

#### HTTP

##### 登录在服务器上

### 电子邮件格式

#### Header（envelop）

传输和递送信息

格式化的行信息

#### Body（content）

携带文本信息

通过空行划分

#### 电子邮件是按顺序的文本行信息

### MIME

#### 作用

##### 扩展和自动化了编码机制

##### 允许多个组成部分在一个邮件传输

#### 特点

##### 用已经存在的邮件系统改编

###### 将数据编码为ASCII码

##### 可扩展的

###### 只需要发送方和接收方对编码方式达成一致

### FTP

#### TCP, port 21/20

#### C/S模型

##### 客户端建立连接

#### 在多种操作系统和文件系统上运行

#### 需要在远程文件系统接入控制

#### 控制和数据连接

##### 控制连接

###### port 21

###### 客户端认证

###### 客户浏览远程目录

##### 数据连接

###### 服务器创建第二条连接

###### 一个文件建立一条连接

###### 传输结束后关闭连接

##### 服务器维护用户状态

### WWW：World Wide Web

#### 含义

一个**分布式**的通过**HTTP**连接的**网页数据库**

#### 组成部分

##### 基础设施

###### 客户端

###### 服务器（DNS，CDN，Datecenters）

##### 内容

###### URL：标识唯一的地址

$$
<protocol>://<host>:<port>/<path>?query\_string
$$

协议：HTTP, FTP

主机：DNS name or IP

Path：文件在对象的目录

Query_string：请求参数

###### HTML：编码方式

##### 信息交换协议

###### HTTP

### HTTP协议

#### 客户端/服务器结构

#### TCP Port80

#### 无状态的

客户端信息不保存在服务器中

#### ASCII formant

#### 操作类型

读

##### GET

##### HEAD

写

##### POST

向指定的URL路径实体上传文件

##### DELETE

删除指定URL域的文件

#### HTTP请求信息

##### 请求行

###### 方法字段，URL字段，HTTP版本字段

##### 首部行



#### HTTP回复报文

##### 状态行

###### HTTP版本字段，状态码，状态信息

##### 首部行

##### 实体体

#### HTTP是无状态的

##### 可扩展性好

###### 错误处理更容易

###### 请求处理更快

###### 请求顺序无关

##### 一些应用需要持续的状态

#### 无状态协议中的状态：Cookies

##### 客户端负责维护

客户端代表服务器存储状态

客户端在请求时发送Cookies

##### 信息存储在服务器的后端数据库中

#### 网络服务目标

##### 用户

###### 快速的下载

改善网络协议

缓存副本

###### 可适应

缓存副本

##### 内容提供方

###### 用户满意

###### 更低的成本

开发更经济的体制

CDN，数据中心

##### 网络

###### 避免过载

缓存副本

#### HTTP效果

大多数Web页面可存在来自多个实体的信息，每个实体都需要建立一条TCP连接

##### 实体请求时间

$$
2 \times RTT + TransmissionTime
$$

#### 提高效率的方式

##### 同时发起多个请求

###### 更多的连接

###### 问题

网络负载过重

##### 持续连接

在多个请求时维护TCP连接

###### 优势

避免了多次建立和终止来凝结的开销

允许底层协议可以充分学习带宽

##### 流水线请求/回复

成批处理请求和回复，减少TCP报文数目

##### 获取n个小的实体：时间主要由时延决定

###### 一次一个

$$
2nRTT
$$

###### 同时传输m个

$$
2[n/m]RTT
$$

###### 连续传输

$$
(n+1)RTT
$$

###### 流水线

$$
2RTT
$$

##### 传输大小为F的文件：时间受带宽限制

###### 一次一个

$$
nF/B
$$

###### m个并行

$$
[n/m]F/B
$$

###### 流水线和持续

$$
nF/B
$$

#### 缓存

##### 原因

###### 增加服务器和网络负担

###### 增加客户端网络时延

##### 逆向代理

接近服务器的缓存

减轻服务器负担

由内容提供方安装

##### 正向代理

接近客户端的缓存

由ISP和企业安装

### CDN网络（内容分发网络）

#### 方法

##### 将内容通过互联包拷贝到若干服务器上

##### CDN分发节点协调内容分发

##### 把内容放置在接近用户的位置

#### CND用户

##### 内容提供商

#### 实现

##### DNS

利用**权威DNS服务器重定向请求**

将一个域名映射到多个地址

##### 路由

基于内容路由到最近的CDN服务器

##### URL重写

##### 重定向策略

负载均衡，网络时延，缓存地址

#### 过程

1、重写URL

2、DNS得到CDN IP address

3、填充CDN缓存

4、从CDN收到缓存内容

##### CDN提供了一个在应用层上的网络

